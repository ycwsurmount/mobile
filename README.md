移动端常见兼容问题-中高级前端必须注意的40条移动端H5坑位指南

<div class="com-markdown-collpase"><div class="com-markdown-collpase-main" style="max-height: 1e+07px;"><div><div class="rno-markdown J-articleContent rno-"><h3 id="%E5%89%8D%E8%A8%80" name="%E5%89%8D%E8%A8%80"><strong>前言</strong></h3><p>不知不觉在网易已有三年半，占了一半时间都在与移动端打交道，整个阶段都是遇坑填坑的学习过程。移动端开发在前端里像神一样地存在，不是说它多难而是说它坑位实在太多了，怎样填都填不完。<code>Android</code>和<code>iOS</code>各显神通，<code>Android</code>的系统版本和屏幕分辨率多得难以一招兼容，<code>iOS</code>的顽固标准和未知特性多得难以快速掌握。</p><p>三年半沉淀通过本文记录下所遇到的坑位，或许有些坑位还未遇到，但本文记录的<strong>「40条坑位」</strong>绝对能让同学们少走很多弯路，特别是前端小白。为了减少废话提高本文质量，对以下内容做一些约定。</p><ul class="ul-level-0"><li>提及的安卓系统包括<code>Android</code>和基于<code>Android</code>开发的系统</li><li>提及的苹果系统包括<code>iOS</code>和<code>iPadOS</code></li><li>本文针对的开发场景是<code>移动端浏览器</code>，因此大部分坑位的解决方案在<code>桌面端浏览器</code>里不一定有效</li><li>解决方案若未提及适用系统就默认在安卓系统和苹果系统上都适用，若提及适用系统则会详细说明</li><li><code>Webkit</code>及其衍生内核在<code>移动端浏览器</code>市场占有率里达到惊人的<code>97%</code>，因此无需太过担心<code>CSS3</code>、<code>ES6</code>和<code>浏览器新特性</code>的兼容性</li><li>真正的开发环境都是基于<code>webpack</code>构建，因此代码演示都不会带上CSS前缀，除非该属性是<code>Webkit</code>独有才会带上<code>-webkit-</code></li></ul><p>每次填坑都是一次实践过程，全部坑位的源码都按语言方向记录在笔者Github上，若有未记录的坑位可提PR让笔者合并，给个Star支持下咧！</p><p>本来想为每个坑位都<code>截图</code>或<code>录制GIF</code>作为演示，但考虑到目前掘金的<code>Markdown编辑器</code>操作图片还存在缺陷就放弃了，每次上传图片都会花费很多时间甚至上传失败(<strong>「望掘金的产品小姐姐和程序小哥哥优化喔」</strong>)。若需演示只能自行复制代码了。</p><h3 id="HTML%E6%96%B9%E5%90%91" name="HTML%E6%96%B9%E5%90%91"><strong>HTML方向</strong></h3><h5 id="%E8%B0%83%E7%94%A8%E7%B3%BB%E7%BB%9F%E5%8A%9F%E8%83%BD" name="%E8%B0%83%E7%94%A8%E7%B3%BB%E7%BB%9F%E5%8A%9F%E8%83%BD"><strong>调用系统功能</strong></h5><p>使用<code>&lt;a&gt;</code>能快速调用移动设备的<code>电话/短信/邮件</code>三大通讯功能，使用<code>&lt;input&gt;</code>能快速调用移动设备的的<code>图库/文件</code>。</p><p>这些功能方便了页面与系统的交互，关键在于调用格式一定要准确，否则会被<code>移动端浏览器</code>忽略。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 拨打电话 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"tel:10086"</span><span class="token operator">&gt;</span>拨打电话给<span class="token number">10086</span>小姐姐<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 发送短信 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"sms:10086"</span><span class="token operator">&gt;</span>发送短信给<span class="token number">10086</span>小姐姐<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 发送邮件 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"mailto:young.joway@aliyun.com"</span><span class="token operator">&gt;</span>发送邮件给JowayYoung<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 选择照片或拍摄照片 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"file"</span> accept<span class="token operator">=</span><span class="token string">"image/*"</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 选择视频或拍摄视频 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"file"</span> accept<span class="token operator">=</span><span class="token string">"video/*"</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 多选文件 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"file"</span> multiple<span class="token operator">&gt;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h5 id="%E5%BF%BD%E7%95%A5%E8%87%AA%E5%8A%A8%E8%AF%86%E5%88%AB" name="%E5%BF%BD%E7%95%A5%E8%87%AA%E5%8A%A8%E8%AF%86%E5%88%AB"><strong>忽略自动识别</strong></h5><p>有些<code>移动端浏览器</code>会自动将数字字母符号识别为<code>电话/邮箱</code>并将其渲染成上述<strong>「调用系统功能」</strong>里的<code>&lt;a&gt;</code>。虽然很方便却有可能违背需求。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 忽略自动识别电话 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"format-detection"</span> content<span class="token operator">=</span><span class="token string">"telephone=no"</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 忽略自动识别邮箱 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"format-detection"</span> content<span class="token operator">=</span><span class="token string">"email=no"</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 忽略自动识别电话和邮箱 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"format-detection"</span> content<span class="token operator">=</span><span class="token string">"telephone=no, email=no"</span><span class="token operator">&gt;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h5 id="%E5%BC%B9%E5%87%BA%E6%95%B0%E5%AD%97%E9%94%AE%E7%9B%98" name="%E5%BC%B9%E5%87%BA%E6%95%B0%E5%AD%97%E9%94%AE%E7%9B%98"><strong>弹出数字键盘</strong></h5><p>使用<code>&lt;input type="tel"&gt;</code>弹起数字键盘会带上<code>#</code>和<code>*</code>，适合输入电话。推荐使用<code>&lt;input type="number" pattern="\d*"&gt;</code>弹起数字键盘，适合输入<a data-text-link="71_1784505" data-from="10680" href="https://cloud.tencent.com/product/captcha?from=10680" target="_blank">验证码</a>等纯数字格式。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 纯数字带#和<span class="token operator">*</span> <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"tel"</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 纯数字 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"number"</span> pattern<span class="token operator">=</span><span class="token string">"\d*"</span><span class="token operator">&gt;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h5 id="%E5%94%A4%E9%86%92%E5%8E%9F%E7%94%9F%E5%BA%94%E7%94%A8" name="%E5%94%A4%E9%86%92%E5%8E%9F%E7%94%9F%E5%BA%94%E7%94%A8"><strong>唤醒原生应用</strong></h5><p>通过<code>location.href</code>与原生应用建立通讯渠道，这种页面与客户端的通讯方式称为<strong>「URL Scheme」</strong>，其基本格式为<code>scheme://[path][?query]</code>，笔者曾经发表过《H5与App的通讯方式》讲述<code>URL Scheme</code>的使用。</p><ul class="ul-level-0"><li><strong>「scheme」</strong>：应用标识，表示应用在系统里的唯一标识</li><li><strong>「path」</strong>：应用行为，表示应用某个页面或功能</li><li><strong>「query」</strong>：应用参数，表示应用页面或应用功能所需的条件参数</li></ul><p><code>URL Scheme</code>一般由前端与客户端共同协商。唤醒原生应用的前提是必须在移动设备里安装了该应用，有些<code>移动端浏览器</code>即使安装了该应用也无法唤醒原生应用，因为它认为<code>URL Scheme</code>是一种潜在的危险行为而禁用它，像<code>Safari</code>和<code>微信浏览器</code>。还好<code>微信浏览器</code>可开启白名单让<code>URL Scheme</code>有效。</p><p>若在页面引用第三方原生应用的<code>URL Schema</code>，可通过抓包第三方原生应用获取其<code>URL</code>。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 打开微信 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"weixin://"</span><span class="token operator">&gt;</span>打开微信<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 打开支付宝 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"alipays://"</span><span class="token operator">&gt;</span>打开支付宝<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 打开支付宝的扫一扫 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"alipays://platformapi/startapp?saId=10000007"</span><span class="token operator">&gt;</span>打开支付宝的扫一扫<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 打开支付宝的蚂蚁森林 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"alipays://platformapi/startapp?appId=60000002"</span><span class="token operator">&gt;</span>打开支付宝的蚂蚁森林<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h5 id="%E7%A6%81%E6%AD%A2%E9%A1%B5%E9%9D%A2%E7%BC%A9%E6%94%BE" name="%E7%A6%81%E6%AD%A2%E9%A1%B5%E9%9D%A2%E7%BC%A9%E6%94%BE"><strong>禁止页面缩放</strong></h5><p>在智能手机的普及下，很多网站都具备<code>桌面端</code>和<code>移动端</code>两种浏览版本，因此无需双击缩放查看页面。禁止页面缩放可保障<code>移动端浏览器</code>能无遗漏地展现页面所有布局。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"viewport"</span> content<span class="token operator">=</span><span class="token string">"width=device-width, user-scalable=no, initial-scale=1, minimum-scale=1, maximum-scale=1"</span><span class="token operator">&gt;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div><h5 id="%E7%A6%81%E6%AD%A2%E9%A1%B5%E9%9D%A2%E7%BC%93%E5%AD%98" name="%E7%A6%81%E6%AD%A2%E9%A1%B5%E9%9D%A2%E7%BC%93%E5%AD%98"><strong>禁止页面缓存</strong></h5><p><strong>「Cache-Control」</strong>指定请求和响应遵循的缓存机制，不想使用浏览器缓存就禁止呗！</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">"Cache-Control"</span> content<span class="token operator">=</span><span class="token string">"no-cache"</span><span class="token operator">&gt;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div><h5 id="%E7%A6%81%E6%AD%A2%E5%AD%97%E6%AF%8D%E5%A4%A7%E5%86%99" name="%E7%A6%81%E6%AD%A2%E5%AD%97%E6%AF%8D%E5%A4%A7%E5%86%99"><strong>禁止字母大写</strong></h5><p>有时在输入框里输入文本会默认开启首字母大写纠正，就是输入首字母小写会被自动纠正成大写，特么的烦。直接声明<code>autocapitalize=off</code>关闭首字母大写功能和<code>autocorrect=off</code>关闭纠正功能。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token operator">&lt;</span>input autocapitalize<span class="token operator">=</span><span class="token string">"off"</span> autocorrect<span class="token operator">=</span><span class="token string">"off"</span><span class="token operator">&gt;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div><h5 id="%E9%92%88%E5%AF%B9Safari%E9%85%8D%E7%BD%AE" name="%E9%92%88%E5%AF%B9Safari%E9%85%8D%E7%BD%AE"><strong>针对Safari配置</strong></h5><p>贴一些<code>Safari</code>较零散且少用的配置。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 设置Safari全屏，在iOS7<span class="token operator">+</span>无效 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"apple-mobile-web-app-capable"</span> content<span class="token operator">=</span><span class="token string">"yes"</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 改变Safari状态栏样式，可选<span class="token keyword">default</span><span class="token operator">/</span>black<span class="token operator">/</span>black<span class="token operator">-</span>translucent，需在上述全屏模式下才有效 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"apple-mobile-web-app-status-bar-style"</span> content<span class="token operator">=</span><span class="token string">"black"</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 添加页面启动占位图 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">"apple-touch-startup-image"</span> href<span class="token operator">=</span><span class="token string">"pig.jpg"</span> media<span class="token operator">=</span><span class="token string">"(device-width: 375px)"</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 保存网站到桌面时添加图标 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">"apple-touch-icon"</span> sizes<span class="token operator">=</span><span class="token string">"76x76"</span> href<span class="token operator">=</span><span class="token string">"pig.jpg"</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 保存网站到桌面时添加图标且清除默认光泽 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">"apple-touch-icon-precomposed"</span> href<span class="token operator">=</span><span class="token string">"pig.jpg"</span><span class="token operator">&gt;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h5 id="%E9%92%88%E5%AF%B9%E5%85%B6%E4%BB%96%E6%B5%8F%E8%A7%88%E5%99%A8%E9%85%8D%E7%BD%AE" name="%E9%92%88%E5%AF%B9%E5%85%B6%E4%BB%96%E6%B5%8F%E8%A7%88%E5%99%A8%E9%85%8D%E7%BD%AE"><strong>针对其他浏览器配置</strong></h5><p>贴一些其他浏览器较零散且少用的配置，主要是常用的<code>QQ浏览器</code>、<code>UC浏览器</code>和<code>360浏览器</code>。从网易MTL的测试数据得知，新版的<code>QQ浏览器</code>和<code>UC浏览器</code>已不支持以下<code>&lt;meta&gt;</code>声明了。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 强制<span class="token constant">QQ</span>浏览器竖屏 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"x5-orientation"</span> content<span class="token operator">=</span><span class="token string">"portrait"</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 强制<span class="token constant">QQ</span>浏览器全屏 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"x5-fullscreen"</span> content<span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 开启<span class="token constant">QQ</span>浏览器应用模式 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"x5-page-mode"</span> content<span class="token operator">=</span><span class="token string">"app"</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 强制<span class="token constant">UC</span>浏览器竖屏 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"screen-orientation"</span> content<span class="token operator">=</span><span class="token string">"portrait"</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 强制<span class="token constant">UC</span>浏览器全屏 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"full-screen"</span> content<span class="token operator">=</span><span class="token string">"yes"</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 开启<span class="token constant">UC</span>浏览器应用模式 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"browsermode"</span> content<span class="token operator">=</span><span class="token string">"application"</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 开启<span class="token number">360</span>浏览器极速模式 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"renderer"</span> content<span class="token operator">=</span><span class="token string">"webkit"</span><span class="token operator">&gt;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h5 id="%E8%AE%A9:active%E6%9C%89%E6%95%88%EF%BC%8C%E8%AE%A9:hover%E6%97%A0%E6%95%88" name="%E8%AE%A9:active%E6%9C%89%E6%95%88%EF%BC%8C%E8%AE%A9:hover%E6%97%A0%E6%95%88"><strong>让:active有效，让:hover无效</strong></h5><p>有些元素的<code>:active</code>可能会无效，而元素的<code>:hover</code>在点击后会一直处于点击状态，需点击其他位置才能解除点击状态。给<code>&lt;body&gt;</code>注册一个空的<code>touchstart事件</code>可将两种状态反转。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token operator">&lt;</span>body ontouchstart<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div><h3 id="CSS%E6%96%B9%E5%90%91" name="CSS%E6%96%B9%E5%90%91"><strong>CSS方向</strong></h3><h5 id="%E8%87%AA%E5%8A%A8%E9%80%82%E5%BA%94%E5%B8%83%E5%B1%80" name="%E8%87%AA%E5%8A%A8%E9%80%82%E5%BA%94%E5%B8%83%E5%B1%80"><strong>自动适应布局</strong></h5><p>针对移动端，笔者通常会结合JS依据<code>屏幕宽度</code>与<code>设计图宽度</code>的比例动态声明<code>&lt;html&gt;</code>的<code>font-size</code>，以<code>rem</code>为长度单位声明所有节点的几何属性，这样就能做到大部分移动设备的页面兼容，兼容出入较大的地方再通过<code>媒体查询</code>做特别处理。</p><p>笔者通常将<code>rem布局比例</code>设置成<code>1rem=100px</code>，即在设计图上<code>100px</code>长度在CSS代码上使用<code>1rem</code>表示。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token keyword">function</span> <span class="token function">AutoResponse</span><span class="token punctuation">(</span><span class="token parameter">width <span class="token operator">=</span> <span class="token number">750</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> target <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span>clientWidth <span class="token operator">&gt;=</span> <span class="token number">600</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        target<span class="token punctuation">.</span>style<span class="token punctuation">.</span>fontSize <span class="token operator">=</span> <span class="token string">"80px"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        target<span class="token punctuation">.</span>style<span class="token punctuation">.</span>fontSize <span class="token operator">=</span> target<span class="token punctuation">.</span>clientWidth <span class="token operator">/</span> width <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">+</span> <span class="token string">"px"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">AutoResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"resize"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">AutoResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><p>当然还可依据<code>屏幕宽度</code>与<code>设计图宽度</code>的比例使用<code>calc()</code>动态声明<code>&lt;html&gt;</code>的<code>font-size</code>，这样就能节省上述代码。不对，是完全代替上述代码。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">html <span class="token punctuation">{</span>
    font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100vw <span class="token operator">/</span> <span class="token number">7.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div><p>若以<code>iPad Pro</code>分辨率<code>1024px</code>为移动端和桌面端的断点，还可结合<code>媒体查询</code>做断点处理。<code>1024px</code>以下使用<code>rem布局</code>，否则不使用<code>rem布局</code>。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">@media screen <span class="token function">and</span> <span class="token punctuation">(</span><span class="token parameter">max<span class="token operator">-</span>width<span class="token operator">:</span> 1024px</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    html <span class="token punctuation">{</span>
        font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100vw <span class="token operator">/</span> <span class="token number">7.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h5 id="%E8%87%AA%E5%8A%A8%E9%80%82%E5%BA%94%E8%83%8C%E6%99%AF" name="%E8%87%AA%E5%8A%A8%E9%80%82%E5%BA%94%E8%83%8C%E6%99%AF"><strong>自动适应背景</strong></h5><p>使用<code>rem布局</code>声明一个元素背景，多数情况会将<code>background-size</code>声明为<code>cover</code>。可能在设计图对应分辨率的移动设备下，背景会完美贴合显示，但换到其他分辨率的移动设备下就会出现左右空出<code>1px</code>到<code>npx</code>的空隙。</p><p>此时将<code>background-size</code>声明为<code>100% 100%</code>，跟随<code>width</code>和<code>height</code>的变化而变化。反正<code>width</code>和<code>height</code>都是量好的实际尺寸。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token punctuation">.</span>elem <span class="token punctuation">{</span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> 1rem<span class="token punctuation">;</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span> 1rem<span class="token punctuation">;</span>
    <span class="token literal-property property">background</span><span class="token operator">:</span> <span class="token function">url</span><span class="token punctuation">(</span><span class="token string">"pig.jpg"</span><span class="token punctuation">)</span> no<span class="token operator">-</span>repeat center<span class="token operator">/</span><span class="token number">100</span><span class="token operator">%</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h5 id="%E7%9B%91%E5%90%AC%E5%B1%8F%E5%B9%95%E6%97%8B%E8%BD%AC" name="%E7%9B%91%E5%90%AC%E5%B1%8F%E5%B9%95%E6%97%8B%E8%BD%AC"><strong>监听屏幕旋转</strong></h5><p>你还在使用JS判断横屏竖屏调整样式吗？那就真的<code>Out</code>了。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token comment">/* 竖屏 */</span>
@media all <span class="token function">and</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">orientation</span><span class="token operator">:</span> portrait</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* 自定义样式 */</span>
<span class="token punctuation">}</span>
<span class="token comment">/* 横屏 */</span>
@media all <span class="token function">and</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">orientation</span><span class="token operator">:</span> landscape</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* 自定义样式 */</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h5 id="%E6%94%AF%E6%8C%81%E5%BC%B9%E6%80%A7%E6%BB%9A%E5%8A%A8" name="%E6%94%AF%E6%8C%81%E5%BC%B9%E6%80%A7%E6%BB%9A%E5%8A%A8"><strong>支持弹性滚动</strong></h5><p>在苹果系统上非<code>&lt;body&gt;</code>元素的滚动操作可能会存在卡顿，但安卓系统不会出现该情况。通过声明<code>overflow-scrolling:touch</code>调用系统原生滚动事件优化<code>弹性滚动</code>，增加页面滚动的流畅度。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">body <span class="token punctuation">{</span>
    <span class="token operator">-</span>webkit<span class="token operator">-</span>overflow<span class="token operator">-</span>scrolling<span class="token operator">:</span> touch<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span>elem <span class="token punctuation">{</span>
    <span class="token literal-property property">overflow</span><span class="token operator">:</span> auto<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h5 id="%E7%A6%81%E6%AD%A2%E6%BB%9A%E5%8A%A8%E4%BC%A0%E6%92%AD" name="%E7%A6%81%E6%AD%A2%E6%BB%9A%E5%8A%A8%E4%BC%A0%E6%92%AD"><strong>禁止滚动传播</strong></h5><p>与<code>桌面端浏览器</code>不一样，<code>移动端浏览器</code>有一个奇怪行为。当页面包含多个滚动区域时，滚完一个区域后若还存在滚动动量则会将这些剩余动量传播到下一个滚动区域，造成该区域也滚动起来。这种行为称为<strong>「滚动传播」</strong>。</p><p>若不想产生这种奇怪行为可直接禁止。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token punctuation">.</span>elem <span class="token punctuation">{</span>
    overscroll<span class="token operator">-</span>behavior<span class="token operator">:</span> contain<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div><h5 id="%E7%A6%81%E6%AD%A2%E5%B1%8F%E5%B9%95%E6%8A%96%E5%8A%A8" name="%E7%A6%81%E6%AD%A2%E5%B1%8F%E5%B9%95%E6%8A%96%E5%8A%A8"><strong>禁止屏幕抖动</strong></h5><p>对于一些突然出现滚动条的页面，可能会产生左右抖动的不良影响。在一个滚动<a data-text-link="443_1784505" data-from="10680" href="https://cloud.tencent.com/product/tke?from=10680" target="_blank">容器</a>里，打开弹窗就隐藏滚动条，关闭弹窗就显示滚动条，来回操作会让屏幕抖动起来。提前声明滚动容器的<code>padding-right</code>为滚动条宽度，就能有效消除这个不良影响。</p><p>每个<code>移动端浏览器</code>的滚动条宽度都有可能不一致，甚至不一定占位置，通过以下方式能间接计算出滚动条的宽度。<code>100vw</code>为视窗宽度，<code>100%</code>为滚动容器内容宽度，相减就是滚动条宽度，妥妥的动态计算。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">body <span class="token punctuation">{</span>
    padding<span class="token operator">-</span>right<span class="token operator">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100vw <span class="token operator">-</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div><h5 id="%E7%A6%81%E6%AD%A2%E9%95%BF%E6%8C%89%E6%93%8D%E4%BD%9C" name="%E7%A6%81%E6%AD%A2%E9%95%BF%E6%8C%89%E6%93%8D%E4%BD%9C"><strong>禁止长按操作</strong></h5><p>有时不想用户长按元素呼出菜单进行<code>点链接</code>、<code>打电话</code>、<code>发邮件</code>、<code>保存图片</code>或<code>扫描二维码</code>等操作，声明<code>touch-callout:none</code>禁止用户长按操作。</p><p>有时不想用户<code>复制粘贴</code>盗文案，声明<code>user-select:none</code>禁止用户长按操作和选择复制。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token operator">*</span> <span class="token punctuation">{</span>
    <span class="token comment">/* pointer-events: none; */</span> <span class="token comment">/* 微信浏览器还需附加该属性才有效 */</span>
    user<span class="token operator">-</span>select<span class="token operator">:</span> none<span class="token punctuation">;</span> <span class="token comment">/* 禁止长按选择文字 */</span>
    <span class="token operator">-</span>webkit<span class="token operator">-</span>touch<span class="token operator">-</span>callout<span class="token operator">:</span> none<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><p>但声明<code>user-select:none</code>会让<code>&lt;input&gt;</code>和<code>&lt;textarea&gt;</code>无法输入文本，可对其声明<code>user-select:auto</code>排除在外。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">input<span class="token punctuation">,</span>
textarea <span class="token punctuation">{</span>
    user<span class="token operator">-</span>select<span class="token operator">:</span> auto<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div><h5 id="%E7%A6%81%E6%AD%A2%E5%AD%97%E4%BD%93%E8%B0%83%E6%95%B4" name="%E7%A6%81%E6%AD%A2%E5%AD%97%E4%BD%93%E8%B0%83%E6%95%B4"><strong>禁止字体调整</strong></h5><p>旋转屏幕可能会改变字体大小，声明<code>text-size-adjust:100%</code>让字体大小保持不变。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token operator">*</span> <span class="token punctuation">{</span>
    text<span class="token operator">-</span>size<span class="token operator">-</span>adjust<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div><h5 id="%E7%A6%81%E6%AD%A2%E9%AB%98%E4%BA%AE%E6%98%BE%E7%A4%BA" name="%E7%A6%81%E6%AD%A2%E9%AB%98%E4%BA%AE%E6%98%BE%E7%A4%BA"><strong>禁止高亮显示</strong></h5><p>触摸元素会出现半透明灰色遮罩，不想要！</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token operator">*</span> <span class="token punctuation">{</span>
    <span class="token operator">-</span>webkit<span class="token operator">-</span>tap<span class="token operator">-</span>highlight<span class="token operator">-</span>color<span class="token operator">:</span> transparent<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div><h5 id="%E7%A6%81%E6%AD%A2%E5%8A%A8%E7%94%BB%E9%97%AA%E5%B1%8F" name="%E7%A6%81%E6%AD%A2%E5%8A%A8%E7%94%BB%E9%97%AA%E5%B1%8F"><strong>禁止动画闪屏</strong></h5><p>在移动设备上添加动画，多数情况会出现闪屏，给动画元素的父元素构造一个<code>3D环境</code>就能让动画稳定运行了。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token punctuation">.</span>elem <span class="token punctuation">{</span>
    <span class="token literal-property property">perspective</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">;</span>
    backface<span class="token operator">-</span>visibility<span class="token operator">:</span> hidden<span class="token punctuation">;</span>
    transform<span class="token operator">-</span>style<span class="token operator">:</span> preserve<span class="token operator">-</span>3d<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h5 id="%E7%BE%8E%E5%8C%96%E8%A1%A8%E5%8D%95%E5%A4%96%E8%A7%82" name="%E7%BE%8E%E5%8C%96%E8%A1%A8%E5%8D%95%E5%A4%96%E8%A7%82"><strong>美化表单外观</strong></h5><p>表单元素样式太丑希望自定义，<code>appearance:none</code>来帮你。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">button<span class="token punctuation">,</span>
input<span class="token punctuation">,</span>
select<span class="token punctuation">,</span>
textarea <span class="token punctuation">{</span>
    <span class="token literal-property property">appearance</span><span class="token operator">:</span> none<span class="token punctuation">;</span>
    <span class="token comment">/* 自定义样式 */</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h5 id="%E7%BE%8E%E5%8C%96%E6%BB%9A%E5%8A%A8%E5%8D%A0%E4%BD%8D" name="%E7%BE%8E%E5%8C%96%E6%BB%9A%E5%8A%A8%E5%8D%A0%E4%BD%8D"><strong>美化滚动占位</strong></h5><p>滚动条样式太丑希望自定义，<code>::-webkit-scrollbar-*</code>来帮你。记住以下三个关键词就能随机应变了。</p><ul class="ul-level-0"><li>[x] <strong>「::-webkit-scrollbar」</strong>：滚动条整体部分</li><li>[x] <strong>「::-webkit-scrollbar-track」</strong>：滚动条轨道部分</li><li>[x] <strong>「::-webkit-scrollbar-thumb」</strong>：滚动条滑块部分</li></ul><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token operator">:</span><span class="token operator">:</span><span class="token operator">-</span>webkit<span class="token operator">-</span>scrollbar <span class="token punctuation">{</span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> 6px<span class="token punctuation">;</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span> 6px<span class="token punctuation">;</span>
    background<span class="token operator">-</span>color<span class="token operator">:</span> transparent<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">:</span><span class="token operator">:</span><span class="token operator">-</span>webkit<span class="token operator">-</span>scrollbar<span class="token operator">-</span>track <span class="token punctuation">{</span>
    background<span class="token operator">-</span>color<span class="token operator">:</span> transparent<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">:</span><span class="token operator">:</span><span class="token operator">-</span>webkit<span class="token operator">-</span>scrollbar<span class="token operator">-</span>thumb <span class="token punctuation">{</span>
    border<span class="token operator">-</span>radius<span class="token operator">:</span> 3px<span class="token punctuation">;</span>
    background<span class="token operator">-</span>image<span class="token operator">:</span> linear<span class="token operator">-</span><span class="token function">gradient</span><span class="token punctuation">(</span>135deg<span class="token punctuation">,</span> #09f<span class="token punctuation">,</span> #3c9<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h5 id="%E7%BE%8E%E5%8C%96%E8%BE%93%E5%85%A5%E5%8D%A0%E4%BD%8D" name="%E7%BE%8E%E5%8C%96%E8%BE%93%E5%85%A5%E5%8D%A0%E4%BD%8D"><strong>美化输入占位</strong></h5><p>输入框占位文本太丑，<code>::-webkit-input-placeholder</code>来帮你。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token literal-property property">input</span><span class="token operator">:</span><span class="token operator">:</span><span class="token operator">-</span>webkit<span class="token operator">-</span>input<span class="token operator">-</span>placeholder <span class="token punctuation">{</span>
    <span class="token literal-property property">color</span><span class="token operator">:</span> #66f<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div><h5 id="%E5%AF%B9%E9%BD%90%E8%BE%93%E5%85%A5%E5%8D%A0%E4%BD%8D" name="%E5%AF%B9%E9%BD%90%E8%BE%93%E5%85%A5%E5%8D%A0%E4%BD%8D"><strong>对齐输入占位</strong></h5><p>有强迫症的同学总会觉得输入框文本位置整体偏上，感觉未居中心里就痒痒的。<code>桌面端浏览器</code>里声明<code>line-height</code>等于<code>height</code>就能解决，但<code>移动端浏览器</code>里还是未能解决，需将<code>line-height</code>声明为<code>normal</code>才行。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">input <span class="token punctuation">{</span>
    line<span class="token operator">-</span>height<span class="token operator">:</span> normal<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div><h5 id="%E5%AF%B9%E9%BD%90%E4%B8%8B%E6%8B%89%E9%80%89%E9%A1%B9" name="%E5%AF%B9%E9%BD%90%E4%B8%8B%E6%8B%89%E9%80%89%E9%A1%B9"><strong>对齐下拉选项</strong></h5><p>下拉框选项默认向左对齐，是时候改改向右对齐了。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">select option <span class="token punctuation">{</span>
    <span class="token literal-property property">direction</span><span class="token operator">:</span> rtl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div><h5 id="%E4%BF%AE%E5%A4%8D%E7%82%B9%E5%87%BB%E6%97%A0%E6%95%88" name="%E4%BF%AE%E5%A4%8D%E7%82%B9%E5%87%BB%E6%97%A0%E6%95%88"><strong>修复点击无效</strong></h5><p>在苹果系统上有些情况下非可点击元素监听<code>click事件</code>可能会无效，针对该情况只需对不触发<code>click事件</code>的元素声明<code>cursor:pointer</code>就能解决。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token punctuation">.</span>elem <span class="token punctuation">{</span>
    <span class="token literal-property property">cursor</span><span class="token operator">:</span> pointer<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div><h5 id="%E8%AF%86%E5%88%AB%E6%96%87%E6%9C%AC%E6%8D%A2%E8%A1%8C" name="%E8%AF%86%E5%88%AB%E6%96%87%E6%9C%AC%E6%8D%A2%E8%A1%8C"><strong>识别文本换行</strong></h5><p>多数情况会使用JS换行文本，那就真的<code>Out</code>了。若接口返回字段包含<code>\n</code>或<code>&lt;br&gt;</code>，千万别替换掉，可声明<code>white-space:pre-line</code>交由浏览器做断行处理。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token operator">*</span> <span class="token punctuation">{</span>
    white<span class="token operator">-</span>space<span class="token operator">:</span> pre<span class="token operator">-</span>line<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div><h5 id="%E5%BC%80%E5%90%AF%E7%A1%AC%E4%BB%B6%E5%8A%A0%E9%80%9F" name="%E5%BC%80%E5%90%AF%E7%A1%AC%E4%BB%B6%E5%8A%A0%E9%80%9F"><strong>开启硬件加速</strong></h5><p>想动画更流畅吗，开启<code>GPU硬件加速</code>呗！</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token punctuation">.</span>elem <span class="token punctuation">{</span>
    <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token function">translate3d</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/* transform: translateZ(0); */</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div><h5 id="%E6%8F%8F%E7%BB%98%E5%83%8F%E7%B4%A0%E8%BE%B9%E6%A1%86" name="%E6%8F%8F%E7%BB%98%E5%83%8F%E7%B4%A0%E8%BE%B9%E6%A1%86"><strong>描绘像素边框</strong></h5><p>万年话题，如何描绘<code>一像素边框</code>？</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token punctuation">.</span>elem <span class="token punctuation">{</span>
    <span class="token literal-property property">position</span><span class="token operator">:</span> relative<span class="token punctuation">;</span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> 200px<span class="token punctuation">;</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span> 80px<span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token operator">:</span><span class="token operator">:</span>after <span class="token punctuation">{</span>
        <span class="token literal-property property">position</span><span class="token operator">:</span> absolute<span class="token punctuation">;</span>
        <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token literal-property property">border</span><span class="token operator">:</span> 1px solid #f66<span class="token punctuation">;</span>
        <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">200</span><span class="token operator">%</span><span class="token punctuation">;</span>
        <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">200</span><span class="token operator">%</span><span class="token punctuation">;</span>
        <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">;</span>
        <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        transform<span class="token operator">-</span>origin<span class="token operator">:</span> left top<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h5 id="%E6%8E%A7%E5%88%B6%E6%BA%A2%E5%87%BA%E6%96%87%E6%9C%AC" name="%E6%8E%A7%E5%88%B6%E6%BA%A2%E5%87%BA%E6%96%87%E6%9C%AC"><strong>控制溢出文本</strong></h5><p>万年话题，如何控制文本做<code>单行溢出</code>和<code>多行溢出</code>？</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token punctuation">.</span>elem <span class="token punctuation">{</span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> 400px<span class="token punctuation">;</span>
    line<span class="token operator">-</span>height<span class="token operator">:</span> 30px<span class="token punctuation">;</span>
    font<span class="token operator">-</span>size<span class="token operator">:</span> 20px<span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token punctuation">.</span>sl<span class="token operator">-</span>ellipsis <span class="token punctuation">{</span>
        <span class="token literal-property property">overflow</span><span class="token operator">:</span> hidden<span class="token punctuation">;</span>
        text<span class="token operator">-</span>overflow<span class="token operator">:</span> ellipsis<span class="token punctuation">;</span>
        white<span class="token operator">-</span>space<span class="token operator">:</span> nowrap<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token operator">&amp;</span><span class="token punctuation">.</span>ml<span class="token operator">-</span>ellipsis <span class="token punctuation">{</span>
        <span class="token literal-property property">display</span><span class="token operator">:</span> <span class="token operator">-</span>webkit<span class="token operator">-</span>box<span class="token punctuation">;</span>
        <span class="token literal-property property">overflow</span><span class="token operator">:</span> hidden<span class="token punctuation">;</span>
        text<span class="token operator">-</span>overflow<span class="token operator">:</span> ellipsis<span class="token punctuation">;</span>
        <span class="token operator">-</span>webkit<span class="token operator">-</span>line<span class="token operator">-</span>clamp<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token operator">-</span>webkit<span class="token operator">-</span>box<span class="token operator">-</span>orient<span class="token operator">:</span> vertical<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h3 id="JS%E6%96%B9%E5%90%91" name="JS%E6%96%B9%E5%90%91"><strong>JS方向</strong></h3><h5 id="%E7%A6%81%E6%AD%A2%E7%82%B9%E5%87%BB%E7%A9%BF%E9%80%8F" name="%E7%A6%81%E6%AD%A2%E7%82%B9%E5%87%BB%E7%A9%BF%E9%80%8F"><strong>禁止点击穿透</strong></h5><p><code>移动端浏览器</code>里点击操作会存在<code>300ms</code>延迟，往往会造成点击延迟甚至点击无效，这个是众所周知的事情。</p><p><code>2007年</code>苹果发布首款<code>iPhone</code>搭载的<code>Safari</code>为了将桌面端网站能较好地展示在<code>移动端浏览器</code>上而使用了双击缩放。该方案就是上述<code>300ms</code>延迟的主要原因，当用户执行第一次单击后会预留<code>300ms</code>检测用户是否继续执行单击，若是则执行缩放操作，若否则执行点击操作。鉴于该方案的成功，其他<code>移动端浏览器</code>也复制了该方案，现在几乎所有<code>移动端浏览器</code>都配备该功能。而该方案引发的点击延迟被称为<strong>「点击穿透」</strong>。</p><p>在前端领域里最早解决点击穿透是<code>jQuery时代</code>的<code>zepto</code>，估计现在大部分同学都未使用过<code>zepto</code>，其实它就是移动端版本的<code>jquery</code>。<code>zepto</code>封装<code>tap事件</code>能有效地解决点击穿透，通过监听<code>document</code>上的<code>touch事件</code>完成<code>tap事件</code>的模拟，并将<code>tap事件</code>冒泡到<code>document</code>上触发。</p><p>在<code>移动端浏览器</code>上不使用<code>click事件</code>而使用<code>touch事件</code>是因为<code>click事件</code>有着明显的延迟，后续又出现<code>fastclick</code>。该解决方案监听用户是否做了双击操作，可正常使用<code>click事件</code>，而点击穿透就交给<code>fastclick</code>自动判断。更多<code>fastclick</code>原理可自行百度，在此不作过多介绍。</p><p>fastclick有现成的<code>NPM包</code>，可直接安装到项目里。引入<code>fastclick</code>可使用<code>click事件</code>代替<code>tap事件</code>，接入方式极其简单。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token keyword">import</span> Fastclick <span class="token keyword">from</span> <span class="token string">"fastclick"</span><span class="token punctuation">;</span>

FastClick<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div><h5 id="%E7%A6%81%E6%AD%A2%E6%BB%91%E5%8A%A8%E7%A9%BF%E9%80%8F" name="%E7%A6%81%E6%AD%A2%E6%BB%91%E5%8A%A8%E7%A9%BF%E9%80%8F"><strong>禁止滑动穿透</strong></h5><p><code>移动端浏览器</code>里出现弹窗时，若在屏幕上滑动能触发弹窗底下的内容跟着滚动，这个是众所周知的事情。</p><p>首先明确解决滑动穿透需保持哪些交互行为，那就是<code>除了弹窗内容能点击或滚动，其他内容都不能点击或滚动</code>。目前很多解决方案都无法做到这一点，全部解决方案都能禁止<code>&lt;body&gt;</code>的滚动行为却引发其他问题。</p><ul class="ul-level-0"><li>弹窗打开后内部内容无法滚动</li><li>弹窗关闭后页面滚动位置丢失</li><li><code>Webview</code>能上下滑动露出底色</li></ul><p>当打开弹窗时给<code>&lt;body&gt;</code>声明<code>position:fixed;left:0;width:100%</code>并动态声明<code>top</code>。声明<code>position:fixed</code>会导致<code>&lt;body&gt;</code>滚动条消失，此时会发现虽然无滑动穿透，但页面滚动位置早已丢失。通过<code>scrollingElement</code>获取页面当前滚动条偏移量并将其取负值且赋值给<code>top</code>，那么在视觉上就无任何变化。当关闭弹窗时移除<code>position:fixed;left:0;width:100%</code>和动态<code>top</code>。</p><p><code>scrollingElement</code>可兼容地获取<code>scrollTop</code>和<code>scrollHeight</code>等属性，在<code>移动端浏览器</code>里屡试不爽。<code>document.scrollingElement.scrollHeight</code>可完美代替曾经的<code>document.documentElement.scrollHeight || document.body.scrollHeight</code>，一眼看上去就是代码减少了。</p><p>该解决方案在视觉上无任何变化，完爆其他解决方案，其实就是一种反向思维和障眼法。该解决方案完美解决<code>固定弹窗</code>和<code>滚动弹窗</code>对<code>&lt;body&gt;</code>全局滚动的影响，当然也可用于局部滚动容器里，因此很值得推广。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">body<span class="token punctuation">.</span>static <span class="token punctuation">{</span>
    <span class="token literal-property property">position</span><span class="token operator">:</span> fixed<span class="token punctuation">;</span>
    <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token keyword">const</span> body <span class="token operator">=</span> document<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
<span class="token keyword">const</span> openBtn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"open-btn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> closeBtn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"close-btn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
openBtn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> scrollTop <span class="token operator">=</span> document<span class="token punctuation">.</span>scrollingElement<span class="token punctuation">.</span>scrollTop<span class="token punctuation">;</span>
    body<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"static"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>scrollTop<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
closeBtn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    body<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">"static"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h5 id="%E6%94%AF%E6%8C%81%E5%BE%80%E8%BF%94%E5%88%B7%E6%96%B0" name="%E6%94%AF%E6%8C%81%E5%BE%80%E8%BF%94%E5%88%B7%E6%96%B0"><strong>支持往返刷新</strong></h5><p>点击<code>移动端浏览器</code>的<code>前进按钮</code>或<code>后退按钮</code>，有时不会自动执行旧页面的JS代码，这与<code>往返缓存</code>有关。这种情况在<code>Safari</code>上特别明显，简单概括就是往返页面无法刷新。</p><p><strong>「往返缓存」</strong>指浏览器为了在页面间执行前进后退操作时能拥有更流畅体验的一种策略，以下简称<code>BFCache</code>。该策略具体表现为：当用户前往新页面前将旧页面的DOM状态保存在<code>BFCache</code>里，当用户返回旧页面前将旧页面的DOM状态从<code>BFCache</code>里取出并加载。大部分<code>移动端浏览器</code>都会部署<code>BFCache</code>，可大大节省接口请求的时间和带宽。</p><p>了解什么是<code>BFCache</code>再对症下药，解决方案就在<code>window.onunload</code>上做文章。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token comment">// 在新页面监听页面销毁事件</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"onunload"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 执行旧页面代码</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div><p>若在<code>Vue SPA</code>上使用<code>keep-alive</code>也不能让页面刷新，可将接口请求放到<code>beforeRouteEnter()</code>里。</p><p>当然还有另一种解决方案。<code>pageshow事件</code>在每次页面加载时都会触发，无论是首次加载还是再次加载都会触发，这就是它与<code>load事件</code>的区别。<code>pageshow事件</code>暴露的<code>persisted</code>可判断页面是否从<code>BFCache</code>里取出。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"pageshow"</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>persisted <span class="token operator">&amp;&amp;</span> location<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div><p>若浏览器不使用<code>&lt;meta http-equiv="Cache-Control" content="no-cache"&gt;</code>禁用缓存，该解决方案还是很值得一用。</p><h5 id="%E8%A7%A3%E6%9E%90%E6%9C%89%E6%95%88%E6%97%A5%E6%9C%9F" name="%E8%A7%A3%E6%9E%90%E6%9C%89%E6%95%88%E6%97%A5%E6%9C%9F"><strong>解析有效日期</strong></h5><p>在苹果系统上解析<code>YYYY-MM-DD HH:mm:ss</code>这种日期格式会报错<code>Invalid Date</code>，但在安卓系统上解析这种日期格式完全无问题。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">"2019-03-31 21:30:00"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Invalid Date</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div><p>查看<code>Safari</code>相关开发手册发现可用<code>YYYY/MM/DD HH:mm:ss</code>这种日期格式，简单概括就是年月日必须使用<code>/</code>衔接而不能使用<code>-</code>衔接。当然安卓系统也支持该格式，然而接口返回字段的日期格式通常是<code>YYYY-MM-DD HH:mm:ss</code>，那么需替换其中的<code>-</code>为<code>/</code>。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token keyword">const</span> date <span class="token operator">=</span> <span class="token string">"2019-03-31 21:30:00"</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\-</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div><h5 id="%E4%BF%AE%E5%A4%8D%E9%AB%98%E5%BA%A6%E5%9D%8D%E5%A1%8C" name="%E4%BF%AE%E5%A4%8D%E9%AB%98%E5%BA%A6%E5%9D%8D%E5%A1%8C"><strong>修复高度坍塌</strong></h5><p>当页面同时出现以下三个条件时，键盘占位会把页面高度压缩一部分。当输入完成键盘占位消失后，页面高度有可能回不到原来高度，产生坍塌导致<code>Webview</code>底色露脸，简单概括就是输入框失焦后页面未回弹。</p><ul class="ul-level-0"><li>页面高度过小</li><li>输入框在页面底部或视窗中下方</li><li>输入框聚焦输入文本</li></ul><p>只要保持前后滚动条偏移量一致就不会出现上述问题。在输入框聚焦时获取页面当前滚动条偏移量，在输入框失焦时赋值页面之前获取的滚动条偏移量，这样就能间接还原页面滚动条偏移量解决页面高度坍塌。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token keyword">const</span> input <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> scrollTop <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
input<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"focus"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    scrollTop <span class="token operator">=</span> document<span class="token punctuation">.</span>scrollingElement<span class="token punctuation">.</span>scrollTop<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
input<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"blur"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>scrollingElement<span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scrollTop<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h5 id="%E4%BF%AE%E5%A4%8D%E8%BE%93%E5%85%A5%E7%9B%91%E5%90%AC" name="%E4%BF%AE%E5%A4%8D%E8%BE%93%E5%85%A5%E7%9B%91%E5%90%AC"><strong>修复输入监听</strong></h5><p>在苹果系统上的输入框输入文本，<code>keyup/keydown/keypress事件</code>可能会无效。当输入框监听<code>keyup事件</code>时，逐个输入英文和数字会有效，但逐个输入中文不会有效，需按回车键才会有效。</p><p>此时可用<code>input事件</code>代替输入框的<code>keyup/keydown/keypress事件</code>。</p><h5 id="%E7%AE%80%E5%8C%96%E5%9B%9E%E5%88%B0%E9%A1%B6%E9%83%A8" name="%E7%AE%80%E5%8C%96%E5%9B%9E%E5%88%B0%E9%A1%B6%E9%83%A8"><strong>简化回到顶部</strong></h5><p>曾几何时编写一个<code>返回顶部</code>函数麻烦得要死，需<code>scrollTop</code>、<code>定时器</code>和<code>条件判断</code>三者配合才能完成。其实DOM对象里隐藏了一个很好用的函数可完成上述功能，一行核心代码就能搞定。</p><p>该函数就是scrollIntoView，它会滚动目标元素的父容器使之对用户可见，简单概括就是相对视窗让容器滚动到目标元素位置。它有三个可选参数能让<code>scrollIntoView</code>滚动起来更优雅。</p><ul class="ul-level-0"><li><strong>「behavior」</strong>：动画过渡效果，默认<code>auto无</code>，可选<code>smooth平滑</code></li><li><strong>「inline」</strong>：水平方向对齐方式，默认<code>nearest就近对齐</code>，可选<code>start顶部对齐</code>、<code>center中间对齐</code>和<code>end底部对齐</code></li><li><strong>「block」</strong>：垂直方向对齐方式，默认<code>start顶部对齐</code>，可选<code>center中间对齐</code>、<code>end底部对齐</code>和<code>nearest就近对齐</code></li></ul><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token keyword">const</span> gotopBtn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"gotop-btn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
openBtn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">scrollIntoView</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">behavior</span><span class="token operator">:</span> <span class="token string">"smooth"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div><p>当然还可滚动到目标元素位置，只需将<code>document.body</code>修改成目标元素的DOM对象。一行核心代码就能搞掂的事情为何还编写那么多代码去完成，不累吗？</p><h5 id="%E7%AE%80%E5%8C%96%E6%87%92%E6%80%A7%E5%8A%A0%E8%BD%BD" name="%E7%AE%80%E5%8C%96%E6%87%92%E6%80%A7%E5%8A%A0%E8%BD%BD"><strong>简化懒性加载</strong></h5><p>与上述<strong>「简化回到顶部」</strong>一样，编写一个<code>懒性加载</code>函数也同样需<code>scrollTop</code>、<code>定时器</code>和<code>条件判断</code>三者配合才能完成。其实DOM对象里隐藏了一个很好用的函数可完成上述功能，该函数无需监听容器的<code>scroll事件</code>，通过浏览器自身机制完成滚动监听。</p><p>该函数就是IntersectionObserver，它提供一种异步观察目标元素及其祖先元素或顶级文档视窗交叉状态的方法。详情可参照MDN文档，在此不作过多介绍。</p><p>懒性加载的第一种使用场景：<strong>「图片懒加载」</strong>。只需确认图片进入可视区域就赋值加载图片，赋值完成还需对图片停止监听。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token operator">&lt;</span>img data<span class="token operator">-</span>src<span class="token operator">=</span><span class="token string">"pig.jpg"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 很多<span class="token operator">&lt;</span>img<span class="token operator">&gt;</span> <span class="token operator">--</span><span class="token operator">&gt;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token keyword">const</span> imgs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">"img.lazyload"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token parameter">nodes</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    nodes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span>isIntersecting<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 判断是否进入可视区域</span>
            v<span class="token punctuation">.</span>target<span class="token punctuation">.</span>src <span class="token operator">=</span> v<span class="token punctuation">.</span>target<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>src<span class="token punctuation">;</span> <span class="token comment">// 赋值加载图片</span>
            observer<span class="token punctuation">.</span><span class="token function">unobserve</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 停止监听已加载的图片</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
imgs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><p>懒性加载的第二种使用场景：<strong>「下拉加载」</strong>。在列表最底部部署一个占位元素且该元素无任何高度或实体外观，只需确认占位元素进入可视区域就请求接口加载数据。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 很多<span class="token operator">&lt;</span>li<span class="token operator">&gt;</span> <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 也可将#bottom以<span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>的形式插入到<span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>内部的最后位置 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"bottom"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token keyword">const</span> bottom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"bottom"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token parameter">nodes</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> tgt <span class="token operator">=</span> nodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 反正只有一个</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>tgt<span class="token punctuation">.</span>isIntersecting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"已到底部，请求接口"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 执行接口请求代码</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
bottom<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>bottom<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h5 id="%E4%BC%98%E5%8C%96%E6%89%AB%E7%A0%81%E8%AF%86%E5%88%AB" name="%E4%BC%98%E5%8C%96%E6%89%AB%E7%A0%81%E8%AF%86%E5%88%AB"><strong>优化扫码识别</strong></h5><p>通常<code>移动端浏览器</code>都会配备<code>长按二维码图片识别链接</code>的功能，但长按二维码可能无法识别或错误识别。二维码表面看上去是一张图片，可二维码生成方式却五花八门，二维码生成方式有以下三种。</p><ul class="ul-level-0"><li>[x] 使用<code>&lt;img&gt;</code>渲染</li><li>[x] 使用<code>&lt;svg&gt;</code>渲染</li><li>[x] 使用<code>&lt;canvas&gt;</code>渲染</li></ul><p>从网易MTL的测试数据得知，大部分<code>移动端浏览器</code>只能识别<code>&lt;img&gt;</code>渲染的二维码，为了让全部<code>移动端浏览器</code>都能识别二维码，那只能使用<code>&lt;img&gt;</code>渲染二维码了。若使用<code>SVG</code>和<code>Canvas</code>的方式生成二维码，那就想方设法把二维码数据转换成<code>Base64</code>再赋值到<code>&lt;img&gt;</code>的<code>src</code>上。</p><p>一个页面可能存在多个二维码，若长按二维码只能识别最后一个，那只能控制每个页面只存在一个二维码。</p><h5 id="%E8%87%AA%E5%8A%A8%E6%92%AD%E6%94%BE%E5%AA%92%E4%BD%93" name="%E8%87%AA%E5%8A%A8%E6%92%AD%E6%94%BE%E5%AA%92%E4%BD%93"><strong>自动播放媒体</strong></h5><p>常见媒体元素包括音频<code>&lt;audio&gt;</code>和视频<code>&lt;video&gt;</code>，为了让用户得到更好的媒体播放体验与不盲目浪费用户流量，大部分<code>移动端浏览器</code>都明确规定不能自动播放媒体或默认屏蔽<code>autoplay</code>。为了能让媒体在页面加载完成后自动播放，只能显式声明播放。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0"><span class="token keyword">const</span> audio <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"audio"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> video <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"video"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
audio<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
video<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div><p>对于像微信浏览器这样的内置浏览器，还需监听其应用SDK加载完成才能触发上述代码，以保障<code>WebView</code>正常渲染。其他内置浏览器同理，在此不作过多介绍。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"WeixinJSBridgeReady"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 执行上述媒体自动播放代码</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div><p>在苹果系统上明确规定用户交互操作开始后才能播放媒体，未得到用户响应会被<code>Safari</code>自动拦截，因此需监听用户首次触摸操作并触发媒体自动播放，而该监听仅此一次。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left:0">document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"touchstart"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 执行上述媒体自动播放代码</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">once</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div><h3 id="%E6%80%BB%E7%BB%93" name="%E6%80%BB%E7%BB%93"><strong>总结</strong></h3><p>若有未记录的坑位可提PR让笔者合并，我们一起记录更多的<strong>「移动端坑位」</strong>，让更多前端开发者少走弯路。本文也是笔者2021年在掘金社区的首篇文章，希望今年能产出更多高质量文章。从笔者角度上看，一篇文章不是技术多牛逼笔风多优雅才归纳为好文章，而是整体内容能帮助自己和更多人进步才算是好文章。向这个方向进发，为自己打Call。</p><p>上述坑位按照<strong>「HTML方向」</strong>、<strong>「CSS方向」</strong>和<strong>「JS方向」</strong>三大类型划分，能更高效地区分出每个坑位的使用场景和解决方案，减少混乱记忆。当中提及了CSS方向的很多坑位，这些坑位也属于一些CSS开发技巧，若喜欢CSS的同学可了解笔者上架的掘金社区首本CSS小册《玩转CSS的艺术之美》做更深一步学习。</p></div></div>
